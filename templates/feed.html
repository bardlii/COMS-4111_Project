<!DOCTYPE html>
{% extends 'base.html' %}

{% block title %}Feed{% endblock %}

{% block header %}
  <h1>Feed</h1>
{% endblock %}

{% block content %}
    <div class="feed">
        {% for post in posts %}
            <div class="post">
                <p>Posted by {{ post['post_owner_id'] }} on {{ post['post_creation_date'] }}</p>
                <img src="{{ post['post_image_url'] }}" alt="Post Image">
                <h2>Post Content</h2>
                <p><strong>User ID:</strong> {{ post['post_owner_id'] }}</p>
                <button class="view-profile-btn" data-username="{{ post['post_owner_id'] }}">View Profile</button>
                <p><strong>Post Text:</strong> {{ post['post_text'] }}</p>
                <p><strong>Post Image:</strong> {{ post['post_image_url'] }}</p>
            </div>
        {% endfor %}
    </div>

    <script>
        // Add event listener to all view profile buttons
        document.querySelectorAll('.view-profile-btn').forEach(button => {
            button.addEventListener('click', function() {
                // Extract the username from the data attribute
                const username = this.dataset.username;
                // Make a GET request to the viewprofile route with the username as a query parameter
                fetch(`/viewprofile?username=${username}`)
                    .then(response => {
                        // Check if the response status is OK
                        if (response.ok) {
                            // Redirect to the viewprofile page
                            window.location.href = response.url;
                        } else {
                            // Handle error
                            console.error('Error:', response.statusText);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            });
        });
    </script>
{% endblock %}
</html>